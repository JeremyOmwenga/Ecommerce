<?php
session_start();
 $con = mysqli_connect("localhost","root","","ecommerce");
 $sql = "SELECT * FROM `tbl_categories`";
 $all_categories = mysqli_query($con,$sql);
?>
<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="subcategorystyles.css">
         <link rel="icon" type="image/x-icon" href="images/favicon.png">
        <style type="text/css">
            a.nounderline{text-decoration: none;}
        </style>
        <title>DRIP 4 LESS - CLOTHING STORE</title>
    </head>

    <body>

        <section id="headermain">

        <span id="logo">
        <img src="images/D4L-LOGO.jpg" alt="Store Logo" width="150px"  height="150px">
        </span>
        
        <span id="spacer">
            <p></p>
        </span>
        
        <span id="header">
            <h1>DRIP 4 LESS</h1>
        </span>
        
        <span id="spacer">
            <p></p>
        </span>
        <span id="profile">
            <p>PROFILE</p>
            <div class="ringring">
            </div>
            <br>
            <?php
                echo $_SESSION['USERNAME'];
            ?>
            <br>
            <br>
        </span>
    </section>
    <form name="subcategorytype" action="addsubcategory.php" method="post"enctype="multipart/form-data">
        <div class="container">
          <span><h1 id="addsubcategory">Add a subcategory</h1></span>
          <hr>
      
          <label for="subcategory"><b>Name</b></label>
          <input type="text" placeholder="Enter subcategory" name="subcategory" id="subcat" required>
          <br>
          <br>
          <br>
          <label for="category1"><b>Category</b></label>
          <select name="category1" id="category">
            <?php 
                while ($category = mysqli_fetch_array(
                        $all_categories,MYSQLI_ASSOC)):; 
            ?>
                <option value="<?php echo $category["category_id"];
                    // The value we usually set is the primary key
                ?>">
                    <?php echo $category["category_name"];
                        // To show the category name to the user
                    ?>
                </option>
            <?php 
                endwhile; 
            ?>
            </select>
          <br>
          <br>
          <br>
          <button type="submit" class="subcategorybtn">Add subcategory</button> 
  </div>
</form>
    </body>
    </html>
    ------------------------------------------------------------------------------------------------------------------------------------------------------
    <?php


$mysql = new mysqli("localhost","root","","ecommerce");

    $subcategory =  $_REQUEST['subcategory'];
    $category = $_REQUEST['category1'];
    


    $sql = "INSERT INTO tbl_subcategories (subcategory_name, category)
     VALUES ('$subcategory','$category')";
        
        if(mysqli_query($mysql, $sql))
        {
             echo '<script>
        alert("Successfully added a subcategory.");
        window.location="http://localhost/ecommerce/adminpanel-alt.php";
        </script>';
        }
        else
        {
           echo '<script>
        alert("An error occurred. Please try again.");
        window.location="http://localhost/ecommerce/subcategory.php";
        </script>';
        mysqli_error($mysql);
        }
         
        mysqli_close($mysql);

?>      
